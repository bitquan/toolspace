name: Auto-Approve Workflow Runs

on:
    workflow_run:
        workflows: ["*"]
        types: [requested]

permissions:
    actions: write
    contents: read

jobs:
    auto-approve-workflows:
        name: Auto-Approve Copilot Workflow Runs
        runs-on: ubuntu-latest
        if: |
            github.event.workflow_run.actor.login == 'app/copilot-swe-agent' ||
            github.event.workflow_run.actor.login == 'copilot' ||
            github.event.workflow_run.actor.login == 'github-copilot[bot]' ||
            contains(github.event.workflow_run.head_branch, 'copilot/')

        steps:
            - name: Auto-approve Copilot workflow runs
              uses: actions/github-script@v7
              with:
                  script: |
                      console.log('Auto-approving workflow run for: ' + context.payload.workflow_run.actor.login);
                      console.log('Workflow: ' + context.payload.workflow_run.name);
                      console.log('Branch: ' + context.payload.workflow_run.head_branch);

                      // Note: GitHub doesn't provide a direct API to approve workflow runs
                      // This workflow serves as a record that approval would be granted
                      // The actual approval must be done via repository settings

                      console.log('Copilot workflow run noted for auto-approval');
                      console.log('Configure repository settings for automatic workflow approval:');
                      console.log('Settings -> Actions -> General -> Fork pull request workflows');
